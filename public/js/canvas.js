function updatePlayerRotation(e,t){const n=t/17,o=controller.keyState;!o.left&&!o.right||o.left&&o.right||(o.left?yourData.orientation.rotation-=2*n:yourData.orientation.rotation+=2*n)}const projectiles=[];function updateProjectilePosition(e,t){}let nextProjectileFireTime=0;function projectileFireRate(e){if(void 0!=yourData&&controller.keyState.space&&e>nextProjectileFireTime){const t=yourData.orientation.position;const n=3.141592653*(yourData.orientation.rotation-90)*2/360,o={position:{},velocity:{}},i=7;o.position.x=t.x+Math.cos(n)*i,o.position.y=t.y+Math.sin(n)*i,o.velocity.x=(o.position.x-t.x)/i,o.velocity.y=(o.position.y-t.y)/i,socket.emit("onSyncProjectile_c",o),nextProjectileFireTime=e+300}}socket.on("onSyncProjectile_s",function(e){projectiles[projectiles.length]=e}),socket.on("onSyncProjectileDestroy_s",function(e){for(let t=0;t<projectiles.length;t++){if(projectiles[t].id===e){projectiles.splice(t,1);break}}});const canvas={init:function(){frameRender.attachFunction(updatePlayerRotation),frameRender.attachFunction(updateProjectilePosition),frameRender.attachFunction(projectileFireRate),frameRender.attachFunction(canvas.render.func)},collision:{check:function(){}},render:{image:{components:{ship:{name:"rocket-frame",friendlyName:"rocket",extension:"png",frame:{current:1,max:3,delay:300,nextTime:0},elements:[]}},request:{frame:function(e){const t=canvas.render.image.components[e];if(t){const e=t.frame,n=(new Date).getTime();return n>e.nextTime&&(e.nextTime=n+e.delay,e.current++,e.current>e.max&&(e.current=1)),e.current}},componentElement:function(e,t){const n=canvas.render.image.components[e];if(n){if(void 0==n.elements[t-1]){const e=document.createElement("img");e.src="img/"+n.name+t+"."+n.extension,e.alt=n.friendlyName,n.elements[t-1]={element:e,loaded:!1},e.addEventListener("load",function(e){n.elements[t-1].loaded=!0})}return n.elements[t-1]}}}},func:function(e,t){const n=t/17,o=document.getElementsByTagName("canvas")[0],i=o.width,a=o.height,r=o.getContext("2d");r.clearRect(0,0,i,a),r.fillStyle="rgb(230,230,230)",r.fillRect(0,0,i,a);const c=document.getElementById("rocket");r.rotate(0),r.textAlign="center",r.font="20px Georgia";const l=canvas.render.image.request;for(let e=0;e<projectiles.length;e++){const t=projectiles[e],o=t.position;t.velocity;if(t.position.x+=t.velocity.x*n,t.position.y+=t.velocity.y*n,r.beginPath(),r.arc(o.x/100*(i-80)+40,o.y/100*(a-80)+40,3,0,2*Math.PI),r.fillStyle="red",r.fill(),t.owner!=yourData.id){const e=yourData.orientation.position,t=e.x-o.x,n=e.y-o.y;Math.sqrt(t*t+n*n)<4&&(yourData.orientation.position={x:50,y:50})}}for(const e in playersData){const t=playersData[e];if(void 0!=t.orientation){const e=t.orientation.position;t.orientation.velocity;let o=t.orientation.rotation;const s=3.141592653*(o-90)*2/360,m=.2*n;e.x+=Math.cos(s)*m,e.y+=Math.sin(s)*m,e.x>100?e.x=100:e.x<0&&(e.x=0),e.y>100?e.y=100:e.y<0&&(e.y=0);const y=25,f=75,u=e.x/100*(i-80)+40,d=e.y/100*(a-80)+40;o*=Math.PI/180,r.translate(u,d),void 0!=t.username&&(r.fillStyle="black",r.fillText(t.username,0,-50)),r.rotate(o);const p=l.frame("ship"),x=l.componentElement("ship",p);let h=c;void 0!=x&&x.loaded&&(h=x.element),r.drawImage(h,-y/2,-f/2,y,f),r.rotate(-o),r.translate(-u,-d)}}}}};canvas.init();